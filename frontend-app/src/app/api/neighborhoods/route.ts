import { NextResponse } from "next/server";
import { db } from "@db/config/configureClient";
import { sql } from "drizzle-orm";
import { violations } from "@/db/migrations/schema";

/**
 * Baltimore neighborhood catalog (from your screenshots of the city site).
 * Kept in UPPERCASE to match the picker. Duplicates & near-dups are kept if
 * they appear distinctly in the city UI (e.g., dashes vs slashes).
 */
const STATIC_NEIGHBORHOODS = [
  "ABELL",
  "ALLENDALE",
  "ARCADIA",
  "ARLINGTON",
  "ARMISTEAD GARDENS",
  "ASHBURTON",
  "BALTIMORE HIGHLANDS",
  "BALTIMORE-LINWOOD",
  "BARCLAY",
  "BARRE CIRCLE",
  "BAYVIEW/FIFTEENTH STREET",
  "BEECHFIELD",
  "BELAIR-EDISON",
  "BELAIR-PARKSIDE",
  "BELLONA-GITTINGS",
  "BEREA",
  "BETTER WAVERLY",
  "BEVERLY HILLS",
  "BIDDLE STREET",
  "BLYTHEWOOD",
  "BOLTON HILL",
  "BOLTON HILL EAST",
  "BOLTON HILL NORTH",
  "BOLTON HILL WEST",
  "BOOTH-BOYD",
  "BREWERS HILL",
  "BRIDGEVIEW / GREENLAWN",
  "BRIDGEVIEW/GREENLAWN",
  "BROADWAY",
  "BROADWAY EAST",
  "BROENING MANOR",
  "BROOKLYN",
  "BURLEITH-LEIGHTON",
  "BUTCHER'S HILL",
  "CALLAWAY-GARRISON",
  "CAMERON VILLAGE",
  "CANTON",
  "CANTON INDUSTRIAL AREA",
  "CARROLL - CAMDEN INDUSTRIAL AR",
  "CARROLL PARK",
  "CARROLL-SOUTH HILTON",
  "CARROLLTON RIDGE",
  "CEDARCROFT",
  "CEDMONT",
  "CEDONIA",
  "CENTRAL FOREST PARK",
  "CENTRAL PARK HEIGHTS",
  "CHARLES NORTH",
  "CHARLES VILLAGE",
  "CHERRY HILL",
  "CHESWOLDE",
  "CHINQUAPIN PARK-BELVEDERE",
  "CHRISTOPHER",
  "CLAREMONT",
  "CLAREMONT-FREEDOM",
  "CLIFTON PARK",
  "COLDSPRING",
  "COLDSTREAM HOMESTEAD MONTEBELLO",
  "CONCERNED CITIZENS OF FOREST P",
  "COPPIN HEIGHTS/ASH-CO-EAST",
  "CROSS COUNTRY",
  "CROSS KEYS",
  "CURTIS BAY",
  "CURTIS BAY INDUSTRIAL",
  "CUTHBERT",
  "CYLBURN",
  "DARLEY PARK",
  "DICKEYVILLE",
  "DOLFIELD",
  "DORCHESTER",
  "DORCHESTER/GRAN-BARR",
  "DOWNTOWN",
  "DRUID HEIGHTS",
  "DRUID HILL PARK",
  "DUNBAR-BROADWAY",
  "EAST ARLINGTON",
  "EAST BALTIMORE MIDWAY",
  "EASTERWOOD",
  "EASTWOOD",
  "EDMONDSON",
  "EDMONDSON VILLAGE",
  "EDNOR GARDENS-LAKESIDE",
  "ELLWOOD PARK/MONUMENT",
  "EVERGREEN",
  "EVERGREEN LAWN",
  "FAIRFIELD",
  "FAIRFIELD AREA",
  "FAIRMONT",
  "FAIRMOUNT",
  "FALLSTAFF",
  "FEDERAL HILL",
  "FEDERAL HILL/MONTGOMERY",
  "FELLS POINT",
  "FOREST PARK",
  "FOREST PARK GOLF COURSE",
  "FOUR BY FOUR",
  "FRANKFORD",
  "FRANKLIN SQUARE",
  "FRANKLINTOWN",
  "FRANKLINTOWN ROAD",
  "GARWYN OAKS",
  "GAY STREET",
  "GLEN",
  "GLEN OAKS",
  "GLENHAM-BELFORD",
  "GOVANS COMMUNITY CIVIC INTERES",
  "GRACELAND PARK",
  "GREATER MONDAWMIN",
  "GREEKTOWN",
  "GREENMOUNT WEST",
  "GREENSPRING",
  "GROVE PARK",
  "GUILFORD",
  "GWYNNS FALLS",
  "GWYNNS FALLS/LEAKIN PARK",
  "HAMPDEN",
  "HAMPSTEAD HILL",
  "HANLON-LONGWOOD",
  "HANLON/LONGWOOD",
  "HARFORD-ECHODALE-PERRING PARKW",
  "HARFORD-ECHODALE/PERRING PARKW",
  "HARLEM PARK",
  "HARWOOD",
  "HAWKINS POINT",
  "HEATHBROOK",
  "HERITAGE CROSSING",
  "HERRING RUN PARK",
  "HIGHLANDTOWN",
  "HILLEN",
  "HILLSDALE HEIGHTS",
  "HOES HEIGHTS",
  "HOLABIRD INDUSTRIAL PARK",
  "HOLLINS MARKET",
  "HOLLINS PARK",
  "HOMELAND",
  "HOPKINS BAYVIEW",
  "HOWARD PARK",
  "HUDSON-HIGHLANDTOWN",
  "HUNTING RIDGE",
  "IDLEWOOD",
  "INNER HARBOR",
  "IRVINGTON",
  "JOHNS HOPKINS HOMEWOOD",
  "JOHNSTON SQUARE",
  "JONES FALLS AREA",
  "JONESTOWN",
  "JOSEPH LEE",
  "KENILWORTH PARK",
  "KERNWOOD",
  "KERNEWOOD",
  "KESWICK",
  "KRESSON",
  "LAFAYETTE",
  "LAKE EVESHAM",
  "LAKE WALKER",
  "LAKELAND",
  "LANGSTON HUGHES",
  "LAURAVILLE",
  "LEVINDALE",
  "LEXINGTON",
  "LEXINGTON TERRACE",
  "LIBERTY SQUARE",
  "LITTLE ITALY",
  "LOCH RAVEN",
  "LOCUST POINT",
  "LOCUST POINT INDUSTRIAL AREA",
  "LOWER HERRING RUN PARK",
  "LOYOLA/NOTRE DAME",
  "LUCILLE PARK",
  "MADISON NORTH",
  "MADISON PARK",
  "MADISON SOUTH",
  "MADISON STREET",
  "MADISON-EASTEND",
  "MAYFIELD",
  "MAYFIELD - MONTEBELLO",
  "MCELDERRY PARK",
  "MEDFIELD",
  "MEDFORD",
  "MEDFORD/BROENING MANOR",
  "MED-CHARLES",
  "MID-CHARLES",
  "MID-GOVANS",
  "MID-TOWN BELVEDERE",
  "MIDDLE BRANCH/REEDBIRD PARKS",
  "MIDDLE EAST",
  "MIDTOWN-EDMONDSON",
  "MILL HILL",
  "MILLHILL",
  "MILTON-MONTFORD",
  "MONDAWMIN",
  "MONDAWMIN NEIGHBORHOOD",
  "MONTEBELLO",
  "MORAVIA-WALTHER",
  "MORGAN PARK",
  "MORGAN STATE UNIVERSITY",
  "MORRELL PARK",
  "MOSHER",
  "MOUNT ALTO",
  "MOUNT CLARE",
  "MOUNT HOLLY",
  "MOUNT VERNON",
  "MOUNT VERNON PLACE",
  "MOUNT WASHINGTON",
  "MOUNT WINANS",
  "MT PLEASANT PARK",
  "NEW NORTH ROLAND PK/POPLAR HIL",
  "NEW NORTHWOOD",
  "NEW SOUTHWEST/MOUNT CLARE",
  "NORTH HARFORD ROAD",
  "NORTH ROLAND PARK/POPLAR HILL",
  "NORTHWOOD",
  "NORTHWEST COMMUNITY ACTION",
  "NORTHWEST NEIGHBORHOOD ACTION",
  "O'DONNELL HEIGHTS",
  "OAKENSHAWE",
  "OAKLEE",
  "OAKLEY",
  "OLD GOUCHER",
  "OLDTOWN",
  "OLIVER",
  "ORCHARD-BIDDLE",
  "ORIGINAL NORTHWOOD",
  "ORANGEVILLE",
  "ORANGEVILLE INDUSTRIAL AREA",
  "OTTERBEIN",
  "OVERCREST",
  "OVERLEA",
  "PANWAY/BRADDISH AVENUE",
  "PARK CIRCLE",
  "PARK HEIGHTS",
  "PARKLANE",
  "PARKSIDE",
  "PARKVIEW",
  "PARKVIEW/WOODBROOK",
  "PATTERSON PARK",
  "PATTERSON PARK NEIGHBORHOOD",
  "PATTERSON PLACE",
  "PAYSON",
  "PEN LUCY",
  "PEN-FALLSWAY",
  "PENN NORTH",
  "PENN STATION COMMUNITY",
  "PENN-FALLSWAY",
  "PENROSE",
  "PENROSE/FAYETTE STREET OUTREAC",
  "PERKINS HOMES",
  "PERRING LOCH",
  "PIMLICO GOOD NEIGHBORS",
  "PLEASANT VIEW GARDENS",
  "POPPLETON",
  "PORT COVINGTON",
  "PRATT-MONROE",
  "PUBLIC SERVICE COMMISSION",
  "PULASKI HIGHWAY",
  "PULASKI INDUSTRIAL AREA",
  "PURNELL",
  "RADNOR-WINSTON",
  "REISTERSTOWN STATION",
  "REMINGTON",
  "RESERVOIR HILL",
  "RIDGELY'S DELIGHT",
  "RICHNOR SPRINGS",
  "RIVERSIDE",
  "ROGNEL HEIGHTS",
  "ROLAND PARK",
  "ROSEBANK",
  "ROSEMONT",
  "ROSEMONT AVENUE",
  "ROSEMONT EAST",
  "ROSEMONT HOMEOWNERS",
  "ROSEMONT HOMEOWNERS/TENANTS",
  "SABINA-MATTHEW STAWHI",
  "SAINT AGNES",
  "SAINT HELENA",
  "SAINT JOSEPH'S",
  "SAINT JOSEPHS",
  "SAINT PAUL",
  "SANDTOWN WINCHESTER",
  "SANDTOWN-WINCHESTER",
  "SBIC",
  "SETON BUSINESS PARK",
  "SETON HILL",
  "SHARP-LEADENHALL",
  "SHIPLEY HILL",
  "SOUTH BALTIMORE",
  "SOUTH CLIFTON PARK",
  "SOUTHEASTERN/DUNDALK",
  "SOUTH FULTON",
  "SOUTH GOVANS",
  "SOUTHWEST INDUSTRIAL AREA",
  "SPRING GARDEN INDUSTRIAL AREA",
  "STADIUM AREA",
  "STONEWOOD-PENTWOOD-WINSTON",
  "TAYLOR HEIGHTS",
  "TEN HILLS",
  "THE ORCHARDS",
  "TOWANDA-GRANTLEY",
  "TREMONT",
  "TUSCANY-CANTERBURY",
  "UNASSIGNED CAMDEN STATION",
  "UNASSIGNED CANTON",
  "UNASSIGNED CURTIS BAY",
  "UNASSIGNED EAST BALTIMORE",
  "UNASSIGNED SCOTTSVILLE",
  "UNION SQUARE",
  "UNIVERSITY OF MARYLAND",
  "UPLANDS",
  "UPPER FELLS POINT",
  "UPPER NORTHWOOD",
  "UPTON",
  "VILLAGES OF HOMELAND",
  "VIOLETVILLE",
  "WAGNER'S POINT",
  "WAKEFIELD",
  "WALBROOK",
  "WALTHERSON",
  "WASHINGTON HILL",
  "WASHINGTON VILLAGE",
  "WAVERLY",
  "WEST ARLINGTON",
  "WEST CANTON",
  "WEST FOREST PARK",
  "WEST HILLS",
  "WESTFIELD",
  "WESTGATE",
  "WESTPORT",
  "WILSON HEIGHTS",
  "WILSON PARK",
  "WINCHESTER",
  "WINDSOR HILLS",
  "WINSTON GOVANS",
  "WINSTON-GOVANS",
  "WOMEN'S CIVIC LEAGUE OF PIMLIC",
  "WOODBERRY",
  "WOODBOURNE HEIGHTS",
  "WOODBOURNE-McCABE",
  "WOODBOURNE-MCCABE",
  "WOODMERE",
  "WOODRING",
  "WYMAN PARK",
  "WYNDHURST",
  "YALE HEIGHTS",
];

export async function GET() {
  try {
    // Prefer distinct values seen in DB (if any)
    const rows = await db
      .select({ neighborhood: violations.neighborhood })
      .from(violations)
      .where(sql`neighborhood is not null and neighborhood <> ''`)
      .groupBy(violations.neighborhood)
      .limit(2000);

    const fromDb = rows.map((r) => String(r.neighborhood)).filter(Boolean);

    // Merge + sort
    const list = Array.from(new Set([...fromDb, ...STATIC_NEIGHBORHOODS])).sort(
      (a, b) => a.localeCompare(b)
    );

    return NextResponse.json(
      { neighborhoods: list },
      { headers: { "cache-control": "no-store" } }
    );
  } catch {
    // If DB is unreachable, still return the static catalog
    const list = [...STATIC_NEIGHBORHOODS].sort((a, b) => a.localeCompare(b));
    return NextResponse.json(
      { neighborhoods: list },
      { headers: { "cache-control": "no-store" } }
    );
  }
}
